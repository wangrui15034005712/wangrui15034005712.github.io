---
title: Dubbo入门---搭建一个最简单的Demo框架
date: 2018-10-30 16:54:05
comments: true
donate: true
toc: true
categories: SOA
tags: #文章標籤 可以省略
	 - Dubbo
	 - Zookeeper
	 - Maven
---
## Dubbo背景和简介
Dubbo开始于电商系统，因此在这里先从电商系统的**演变**讲起。
<!-- more -->
1.单一应用框架(ORM) 
当网站流量很小时，只需一个应用，将所有功能如下单支付等都部署在一起，以减少部署节点和成本。
**缺点：**单一的系统架构，使得在开发过程中，占用的资源越来越多，而且随着流量的增加越来越难以维护。<br>
![](/dubbo1.png)
2.垂直应用框架(MVC) 
垂直应用架构解决了单一应用架构所面临的扩容问题，流量能够分散到各个子系统当中，且系统的体积可控，一定程度上降低了开发人员之间协同以及维护的成本，提升了开发效率。 
**缺点：**但是在垂直架构中相同逻辑代码需要不断的复制，不能复用。 <br>
![](/dubbo2.png)
3.分布式应用架构(RPC) 
当垂直应用越来越多，应用之间交互不可避免，将核心业务抽取出来，作为独立的服务，逐渐形成稳定的服务中心。<br>
![](/dubbo3.png)
4.流动计算架构(SOA) 
随着服务化的进一步发展，服务越来越多，服务之间的调用和依赖关系也越来越复杂，诞生了面向服务的架构体系(SOA)，也因此衍生出了一系列相应的技术，如对服务提供、服务调用、连接处理、通信协议、序列化方式、服务发现、服务路由、日志输出等行为进行封装的服务框架。<br>
![电商系统的演变可以看出架构演变的过程](/dubbo4.png)
* 单一应用架构
   * 当网站流量很小时，只需一个应用，将所有功能都部署在一起，以减少部署节点和成本。
   * 此时，用于简化增删改查工作量的 数据访问框架(ORM) 是关键。
* 垂直应用架构
   * 当访问量逐渐增大，单一应用增加机器带来的加速度越来越小，将应用拆成互不相干的几个应用，以提升效率。
   * 此时，用于加速前端页面开发的 Web框架(MVC) 是关键。
* 分布式服务架构 
   * 当垂直应用越来越多，应用之间交互不可避免，将核心业务抽取出来，作为独立的服务，逐渐形成稳定的服务中心，使前端应用能更快速的响应多变的市场需求。
   * 此时，用于提高业务复用及整合的 分布式服务框架(RPC) 是关键。
* 流动计算架构 
   * 当服务越来越多，容量的评估，小服务资源的浪费等问题逐渐显现，此时需增加一个调度中心基于访问压力实时管理集群容量，提高集群利用率。
   * 此时，用于提高机器利用率的 资源调度和治理中心(SOA) 是关键。
---
## Dubbo是什么
Dubbo是：
一款分布式服务框架
高性能和透明化的RPC远程服务调用方案
SOA服务治理方案
每天为2千多个服务提供大于30亿次访问量支持，并被广泛应用于阿里巴巴集团的各成员站点以及别的公司的业务中。

---
## Dubbo架构
![](/dubbo5.png)
**Provider: **暴露服务的服务提供方。 
**Consumer: **调用远程服务的服务消费方。 
**Registry: **服务注册与发现的注册中心。 
**Monitor: **统计服务的调用次数和调用时间的监控中心。

**调用流程**
0.服务容器负责启动，加载，运行服务提供者。 
1.服务提供者在启动时，向注册中心注册自己提供的服务。 
2.服务消费者在启动时，向注册中心订阅自己所需的服务。 
3.注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。 
4.服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。 
5.服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。

---
## Dubbo注册中心
对于服务提供方，它需要发布服务，而且由于应用系统的复杂性，服务的数量、类型也不断膨胀； 
对于服务消费方，他关心如何获取到它所需要的服务，而面对复杂的应用系统，需要管理大量的服务调用。
对于服务提供方和服务消费方来说，他们还有可能兼具这两种角色，即既需要提供服务，有需要消费服务。

通过将服务统一管理起来，可以有效地优化内部应用对服务发布/使用的流程和管理。服务注册中心可以通过特定协议来完成服务对外的统一。

**Dubbo提供的注册中心有如下几种类型可供选择：**
- Multicast注册中心
- Zookeeper注册中心
- Redis注册中心
- Simple注册中心

---
## Dubbo优缺点
**优点：**
1.透明化的远程方法调用 
&nbsp;&nbsp;&nbsp;&nbsp;像调用本地方法一样调用远程方法；只需简单配置，没有任何API侵入。
2.软负载均衡及容错机制 
&nbsp;&nbsp;&nbsp;&nbsp;可在内网替代nginx lvs等硬件负载均衡器。
3.服务注册中心自动注册 & 配置管理 
&nbsp;&nbsp;&nbsp;&nbsp;不需要写死服务提供者地址，注册中心基于接口名自动查询提供者ip。 
&nbsp;&nbsp;&nbsp;&nbsp;使用类似zookeeper等分布式协调服务作为服务注册中心，可以将绝大部分项目配置移入zookeeper集群。
4.服务接口监控与治理 
&nbsp;&nbsp;&nbsp;&nbsp;Dubbo-admin与Dubbo-monitor提供了完善的服务接口管理与监控功能，针对不同应用的不同接口，可以进行 多版本，多协议，多注册中心管理。
**缺点：**只支持JAVA语言

---
## Dubbo入门Demo
了解了Dubbo以后，自然要搭建一个简单的Demo实现。本文采用Dubbo与Zookeeper、Spring框架的整合。
**主要步骤：**
1.安装Zookeeper,启动； 
2.创建MAVEN项目，构建Dubbo+Zookeeper+Spring实现的简单Demo； 
3.安装Dubbo-admin，实现监控。
### Zookeeper介绍与安装
本Demo中的Dubbo注册中心采用的是Zookeeper。为什么采用Zookeeper呢？
Zookeeper是一个分布式的服务框架，是树型的目录服务的数据存储，能做到集群管理数据 ，这里能很好的作为Dubbo服务的注册中心。
Dubbo能与Zookeeper做到集群部署，当提供者出现断电等异常停机时，Zookeeper注册中心能自动删除提供者信息，当提供者重启时，能自动恢复注册数据，以及订阅请求。
具体的安装方法在此不一一叙述，可参考博文： [zookeeper安装和使用 windows环境](https://lastsummer.top/blog/2018/10/30/zookeeper安装和使用-windows环境/)<br>
安装完成后，进入到bin目录，并且启动zkServer.cmd，这个脚本中会启动一个java进程： 
(注：需要先启动zookeeper后，后续dubbo demo代码运行才能使用zookeeper注册中心的功能，不可关闭) 
### MAVEN项目
- 项目结构： 
- 主要分三大模块： 
- dubbo-api : 存放公共接口； 
- dubbo-provider : 提供远程服务；
- dubbo-consumer :　调用远程服务； 
- dubbo-consumer2 :　调用远程服务；
![目录结构](/dubbo6.png)
具体的项目在此不一一叙述，整个项目的代码已经上传到我的github上https://github.com/wangrui15034005712/dubboTest.git 欢迎下载查看。
运行项目，先确保provider已被运行后再启动consumer模块： 
当然，这只是一个模拟的项目，实际中有多提供者多消费者情况，比这要复杂的多，当然只有这样才能体现dubbo的特性。
---
## Dubbo管理控制台介绍
![](/dubbo7.png)
下载dubbo-admin，可自行根据网上介绍安装。大致做法就是将dubbo-admin中 的某个文件夹内容替换到tomcat的conf中，再运行tomcat即可。但我在实际操作中发现JDK8无法运行，后来找到一个JDK8可以实现的dubbo-admin版本，下载地址：链接: https://pan.baidu.com/s/1dxu1NctjLowFQylINul3gA 提取码: 5ci8 。
把下载的dubbo-admin-2.6.0.war放置tomcat下的webapp中,访问localhost:8080/dubbo-admin-2.6.0即可访问管理控制台，账号密码默认都是root。
![启动zookeeper-启动tomcat-启动-启动Provider-启动Consumer-访问localhost:8080/dubbo-admin-2.6.0](/dubbo8.png)

个人博客：[去年夏天](https://lastsummer.top)
参考博客：[Dubbo入门---搭建一个最简单的Demo框架](https://blog.csdn.net/noaman_wgs/article/details/70214612)